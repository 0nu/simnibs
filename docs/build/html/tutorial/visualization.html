
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Visualizing Results &#8212; SimNIBS 3.0b0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Creating Head Models" href="head_meshing.html" />
    <link rel="prev" title="Accessing the Command Prompt on Windows" href="win_prompt.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="visualizing-results">
<span id="visualization-tutorial"></span><h1>Visualizing Results<a class="headerlink" href="#visualizing-results" title="Permalink to this headline">¶</a></h1>
<p>This tutorial comes after the tutorial on <a class="reference internal" href="gui.html#gui-tutorial"><span class="std std-ref">Setting up and Running Simulations</span></a>. Please be sure to complete it before going further.</p>
<p>The final simulation results are in the <em>Output Folder</em>, which can be set in the GUI. By default, this folder is called <code class="file docutils literal notranslate"><span class="pre">simnibs_simulation/</span></code>, and is located in the same folder as the mesh file.</p>
<blockquote>
<div><img alt="../_images/tutorial_output.png" src="../_images/tutorial_output.png" />
</div></blockquote>
<dl class="simple">
<dt></dt><dd><p>For the current example, the output folder contains the following files and folders:</p>
<ul class="simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">fsavg_overlays/</span></code>: Contains surface overlays with fields in FsAverage space</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">mni_volumes/</span></code>: Contains NIfTI volumes with fields in MNI space</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">subject_overlays/</span></code>: Contains surface overlays with fields in the subject specific space (same as the {subID}_T1fs_conform.nii.gz)</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">subject_volumes/</span></code>: Contains NIfTI volumes with fields in a subject specific space</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">ernie_TDCS_1_scalar.msh</span></code>: Mesh with tDCS electrodes and electric fields</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">ernie_TMS_2-0001_MagStim_70mm_Fig8_nii_coil_pos.geo</span></code>: Contains a simplified coil model showing it’s center and axes. For “.ccd” coil models, this is a more detail model showing dipoles.</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">ernie_TMS_2-0001_MagStim_70mm_Fig8_nii_scalar.msh</span></code>: Mesh with the TMS-induced electric field</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">simnibs_simulation_yyyymmdd.log</span></code>: Simulation log</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">simnibs_simulation_yyyymmdd.mat</span></code>: Simulation configuration file</p></li>
</ul>
</dd>
</dl>
<div class="section" id="visualizing-results-in-matlab">
<h2>Visualizing Results in MATLAB<a class="headerlink" href="#visualizing-results-in-matlab" title="Permalink to this headline">¶</a></h2>
<p>SimNIBS 2.1.2 added new MATLAB functions for quickly visualizing simulation  results. To use it, add  <code class="file docutils literal notranslate"><span class="pre">matlab/functions/</span></code> subfolder of the SimNIBS installation directory, to the MATLAB path.</p>
<p>To load the tDCS simulation result in MATLAB, navigate to the output folder and call in a MATLAB terminal</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="p">=</span> <span class="n">mesh_load_gmsh4</span><span class="p">(</span>‘<span class="n">ernie_TDCS_1_scalar</span><span class="p">.</span><span class="n">msh</span>’<span class="p">)</span>
<span class="n">mesh_show_surface</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
<p></p>
</div>
<div class="section" id="visualizing-results-in-gmsh">
<h2>Visualizing Results in Gmsh<a class="headerlink" href="#visualizing-results-in-gmsh" title="Permalink to this headline">¶</a></h2>
<p>Gmsh is a powerfull program for 3D visualization. However, it has somewhat steep learning curve. Here we will give the basics as to how to visualize simulation results in Gmsh</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>For Windows and MacOSX users, we recommended <a class="reference external" href="http://gmsh.info/">downloading and installing Gmsh from their website</a></p>
</div>
<ol class="arabic simple">
<li><p>Start Gmsh by double clicking in the <code class="file docutils literal notranslate"><span class="pre">ernie_TDCS_1_scalar.msh</span></code> file (Windows and MacOSX, installation from Gmsh website), or by typing on a terminal window located at the output folder</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmsh ernie_TDCS_1_scalar.msh
</pre></div>
</div>
<dl>
<dt></dt><dd><p>The following window will appear</p>
<blockquote>
<div><img alt="../_images/tutorial_gmshinit.png" src="../_images/tutorial_gmshinit.png" />
</div></blockquote>
</dd>
</dl>
<p></p>
<blockquote>
<div><p>There, we see all the tissue and electrode surfaces. You can rotate the model with the left mouse button, translate it with the right button, and zoom with the mouse wheel</p>
</div></blockquote>
<ol class="arabic" start="2">
<li><p>We will now visualize just the gray matter surface. First, go to <em>Tools</em> → <em>Visibility</em></p>
<img alt="../_images/tutorial_gmshvisibility.png" src="../_images/tutorial_gmshvisibility.png" />
</li>
</ol>
<p></p>
<ol class="arabic" start="3">
<li><p>There you can select surfaces and volumes to be visualized. In SimNIBS, we have defined</p>
<p>1: White Matter volume</p>
<p>2: Gray Matter volume</p>
<p>3: Cerebrospinal Fluid (CSF) volume</p>
<p>4: Skull volume</p>
<p>5: Skin volume</p>
<p>6: Eye volumes (headreco models only)</p>
<p>101+: Electrode rubber layer volume</p>
<p>501+: Electrode Gel / Sponge volume</p>
<p>The corresponding surfaces have the number 1000 + volume value. For example, 1002 corresponds to the gray matter surface. The only exception are the electrode contacts, numbered 2100+. You can select multiple surfaces or volumes by holding <em>Ctrl</em>. Selecting 1002 and click <em>OK</em></p>
<img alt="../_images/tutorial_gmshsurface.png" src="../_images/tutorial_gmshsurface.png" />
</li>
</ol>
<dl>
<dt></dt><dd><p>We have now a visualization the gray matter surface</p>
<img alt="../_images/tutorial_gmshbrain.png" src="../_images/tutorial_gmshbrain.png" />
</dd>
</dl>
<p>4. Go to <em>Tools</em> → <em>Options</em> → <em>Mesh</em> and deselect <em>Surface Faces</em></p>
<blockquote>
<div><img alt="../_images/tutorial_gmshdeselecsurf.png" src="../_images/tutorial_gmshdeselecsurf.png" />
</div></blockquote>
<dl class="simple">
<dt></dt><dd><p>The model will momentarily disappear.</p>
</dd>
</dl>
<ol class="arabic" start="5">
<li><p>To visualize the norm of the electric field, click on <em>normE</em> on the left side of the main Gmsh window.</p>
<img alt="../_images/tutorial_gmshnorme.png" src="../_images/tutorial_gmshnorme.png" />
</li>
</ol>
<p>6. We now need to adjust the scale of the <em>normE</em> values. To do it, go to <em>Tools</em> → <em>Options</em> → <em>View [1]</em>, set <em>Range mode</em> to <em>Custom</em> and set a reasonable max value, such as 0.35</p>
<blockquote>
<div><img alt="../_images/tutorial_gmshview.png" src="../_images/tutorial_gmshview.png" />
</div></blockquote>
<dl>
<dt></dt><dd><p>This will give a view such as the one bellow</p>
<blockquote>
<div><img alt="../_images/tutorial_gmshnorm.png" src="../_images/tutorial_gmshnorm.png" />
</div></blockquote>
</dd>
</dl>
<p>7. We recommend users to explore the many functionalities of Gmsh. One can, for example, produce the image bellow by selecting the Volume 2 for visualization an clipping the model in <em>Tools</em> →  <em>Clipping</em></p>
<blockquote>
<div><img alt="../_images/tutorial_gmshclip.png" src="../_images/tutorial_gmshclip.png" />
</div></blockquote>
<p></p>
</div>
<div class="section" id="visualizing-surface-overlays-in-freeview">
<h2>Visualizing surface overlays in FreeView<a class="headerlink" href="#visualizing-surface-overlays-in-freeview" title="Permalink to this headline">¶</a></h2>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>FreeView is not avaliable on Windows. However, overlays can also be visualized using the MATLAB usign the <em>mesh_load_fsresults</em> and the <em>mesh_show_surface</em> functions</p>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>To obtain <em>freeview</em> surface files from simulations, please <a class="reference internal" href="../documentation/gui.html#sim-opt"><span class="std std-ref">set the appropriate options from the GUI</span></a>, in the <a class="reference internal" href="../documentation/sim_struct/session.html#session-doc"><span class="std std-ref">SESSION structure</span></a> (if scripting) or use the <a class="reference internal" href="../documentation/command_line/msh2cortex.html#msh2cortex-docs"><span class="std std-ref">msh2cortex</span></a> command line tool</p>
</div>
<p><em>freeview</em> is a visualization tool by FreeSurfer. It allows visualization of the files in the <code class="file docutils literal notranslate"><span class="pre">subject_overlays/</span></code> and <code class="file docutils literal notranslate"><span class="pre">fsavg_overlays/</span></code> folders. You need to have FreeSurfer installed in order to use FreeView</p>
<p>In the <code class="file docutils literal notranslate"><span class="pre">subject_overlays</span></code> folder, we have the files following the pattern</p>
<p><code class="file docutils literal notranslate"><span class="pre">&lt;hemisphere&gt;.&lt;simulation_id&gt;.central.&lt;field&gt;.&lt;scalar_quantity&gt;</span></code></p>
<p>Where</p>
<ul>
<li><p><strong>hemisphere</strong>: Cortical hemisphere: either left hemisphere (lh) or right hemisphere (rh)</p></li>
<li><p><strong>simulation_id</strong>: A name attributed to the simulation, with the subject id, type of simulation, a number, and in the case of TMS a coil position number and the name of the coil file</p></li>
<li><p><strong>field</strong>: typically E (electric field) or J (current density)</p></li>
<li><p><strong>scalar_quantity</strong>: Quantity calculated from the vector field:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>angle</strong>: Angle of the field with a vector normal to the cortical surface, in radians. An angle of 0 indicates that the field vectors are pointing the outside the cortical surface, and an angle of π that the currents are pointing inside. An angle of π/2 indicates that the currents are flowing tangentially to the surface.</p></li>
<li><p><strong>norm</strong>: Norm (i.e., length) of the electric field vector (that is, field strength).</p></li>
<li><p><strong>normal</strong>: Component of the electric field pointing to the inside (negative values) or to the outside (positive values) of the cortical surface.</p></li>
<li><p><strong>tangent</strong>: Component of the electric field tangent to the cortical surface.</p></li>
<li><p><strong>normal</strong>: Component of the electric field pointing to the inside (negative values) or to the outside (positive values) of the cortical surface.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Additionally, we also have the <code class="file docutils literal notranslate"><span class="pre">lh.central</span></code> and <code class="file docutils literal notranslate"><span class="pre">rh.central</span></code> files. Those contain the cortical surface located halfway between the gray and white matter surfaces.</p>
<p>The <code class="file docutils literal notranslate"><span class="pre">fsavg_overlays/</span></code> folder has a very similar structure to the <code class="file docutils literal notranslate"><span class="pre">subject_overlays/</span></code> folder.</p>
<ol class="arabic simple">
<li><p>To start <em>freeview</em> run in a terminal window</p></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>freeview
</pre></div>
</div>
<p>2. Go to <em>File</em> → <em>Load Surface</em> and select the <code class="file docutils literal notranslate"><span class="pre">lh.central</span></code> file to visualize the left hemisphere. To better view the surfaces, select the big white square and the 3D head on the top of the window.</p>
<ol class="arabic simple" start="3">
<li><p>After opening the surface, go to <em>Overlay</em> → <em>Load Generic</em></p></li>
</ol>
<img alt="../_images/tutorial_freeviewloadgeneric.png" src="../_images/tutorial_freeviewloadgeneric.png" />
<ol class="arabic simple" start="4">
<li><p>Click on the folder icon to the right of <em>Select overlay file</em> and select the <code class="file docutils literal notranslate"><span class="pre">lh.ernie_TDCS_1_scalar.central.E.normal</span></code> file</p></li>
</ol>
<img alt="../_images/tutorial_freeviewselectoverlay.png" src="../_images/tutorial_freeviewselectoverlay.png" />
<ol class="arabic simple" start="5">
<li><p>You can adjust the color scale by clicking on <em>Configure</em></p></li>
</ol>
<img alt="../_images/tutorial_freeviewconfigureoverlay.png" src="../_images/tutorial_freeviewconfigureoverlay.png" />
<ol class="arabic simple" start="6">
<li><p>By adjusting the parameters, we can generate a visualization such as the one bellow</p></li>
</ol>
<img alt="../_images/tutorial_freeviewvisualization.png" src="../_images/tutorial_freeviewvisualization.png" />
<dl class="simple">
<dt></dt><dd><p>We can clearly see the electric field inflow (in red) in the posterior part of the gyri and the field outflow (in blue) in the anterior parts.</p>
</dd>
</dl>
</div>
<div class="section" id="visualizing-volumes">
<h2>Visualizing Volumes<a class="headerlink" href="#visualizing-volumes" title="Permalink to this headline">¶</a></h2>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>To obtain nifti volume files from simulations, please <a class="reference internal" href="../documentation/gui.html#sim-opt"><span class="std std-ref">set the appropriate options from the GUI</span></a>, in the <a class="reference internal" href="../documentation/sim_struct/session.html#session-doc"><span class="std std-ref">SESSION structure</span></a> (if scripting) or use the <a class="reference internal" href="../documentation/command_line/msh2nii.html#msh2nii-doc"><span class="std std-ref">msh2nii</span></a> or the <a class="reference internal" href="../documentation/command_line/subject2mni.html#subject2mni-docs"><span class="std std-ref">subject2mni</span></a> command line tool</p>
</div>
<p>The files in the <code class="file docutils literal notranslate"><span class="pre">subject_volumes/</span></code> and <code class="file docutils literal notranslate"><span class="pre">mni_volumes/</span></code> folders are NIfTI files.
Their file names have the format</p>
<blockquote>
<div><p><code class="file docutils literal notranslate"><span class="pre">&lt;simulation_id&gt;_&lt;field&gt;_[MNI].nii.gz</span></code></p>
<ul class="simple">
<li><p><strong>simulation_id</strong>: A name attributed to the simulation, with the subject id, type of simulation, a number, and in the case of TMS a coil position number and the name of the coil file</p></li>
<li><p><strong>field</strong>: For vector quantities, such as E, we have 2 outputs: the vector field (which is 3-dimensional) and the norm of the vectors.</p></li>
<li><p><strong>MNI</strong>: In the case of <code class="file docutils literal notranslate"><span class="pre">mni_volumes/</span></code>, the names are appended by MNI</p></li>
</ul>
</div></blockquote>
<p>The files can be visualized in any NIfTI viewer such as FreeView or FSLeyes.</p>
</div>
<div class="section" id="further-reading">
<h2>Further Reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h2>
<p>For more information on visualization and simulation output, please see the <a class="reference external" href="https://doi.org/10.1101/500314">SimNIBS 2.1 tutorial paper</a>.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorial.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="gui.html">Setting up and Running Simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="win_prompt.html">Accessing the Command Prompt on Windows</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Visualizing Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="head_meshing.html">Creating Head Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="scripting.html">Scripting Simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced/advanced.html">Advanced Features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../documentation/documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="tutorial.html">Tutorial</a><ul>
      <li>Previous: <a href="win_prompt.html" title="previous chapter">Accessing the Command Prompt on Windows</a></li>
      <li>Next: <a href="head_meshing.html" title="next chapter">Creating Head Models</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, SimNIBS Developers.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/tutorial/visualization.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>